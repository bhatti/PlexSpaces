# SPDX-License-Identifier: LGPL-2.1-or-later
# Copyright (C) 2025 Shahzad A. Bhatti <bhatti@plexobject.com>
#
# Default PlexSpaces Release Configuration
#
# This is a minimal release configuration for an empty node.
# The node will start with a default application but no actors.
#
# Configuration can be overridden via environment variables.
# See CONFIG_STREAMLINING_PLAN.md for environment variable mapping.

name: "plexspaces-default"
version: "0.1.0"
description: "Default PlexSpaces node with empty application"

node:
  id: "${NODE_ID:-node1}"
  listen_address: "${NODE_LISTEN_ADDRESS:-0.0.0.0:8000}"
  cluster_seed_nodes: []

runtime:
  grpc:
    enabled: true
    address: "${GRPC_ADDRESS:-0.0.0.0:8000}"
    max_connections: 1000
    keepalive_interval_seconds: 30
    middleware: []
  
  health:
    heartbeat_interval_seconds: 30
    heartbeat_timeout_seconds: 60
    registry_url: ""
  
  security:
    service_identity: {}
    mtls: {}
    jwt: {}
    api_keys: []
  
  blob:
    backend: "${BLOB_BACKEND:-local}"
    bucket: "${BLOB_BUCKET:-plexspaces}"
    endpoint: "${BLOB_ENDPOINT:-}"
    access_key_id: "${BLOB_ACCESS_KEY_ID:-}"
    # secret_access_key should be set via PLEXSPACES_BLOB_SECRET_ACCESS_KEY env var
    use_ssl: false
    prefix: "${BLOB_PREFIX:-/app/data/blob}"
  
  # Shared relational database for scheduler, workflow, object-registry, journaling, blob
  # Defaults to SQLite for easier local development, can be overridden to PostgreSQL
  shared_database:
    connection_string: "${DATABASE_URL:-sqlite:///app/data/plexspaces.db}"
    pool_size: 10
    auto_migrate: true
    migration_paths: []
  
  # Locks backend (sqlite, sql/postgres, redis, dynamodb)
  locks_backend:
    backend_type: "${LOCKS_BACKEND:-sqlite}"
    redis:
      url: "${LOCKS_REDIS_URL:-redis://redis:6379/0}"
      pool_size: 10
      key_prefix: "plexspaces:locks:"
      cluster_mode: false
    sql:
      connection_string: "${LOCKS_POSTGRES_URL:-${LOCKS_SQLITE_PATH:-${DATABASE_URL:-sqlite:///app/data/locks.db}}}"
      pool_size: 10
      auto_migrate: true
  
  # Channel backend (in-memory, redis, kafka, sqlite, nats)
  # Note: PostgreSQL support coming soon, using SQLite for now
  channel_backend:
    backend_type: "${CHANNEL_BACKEND:-sqlite}"
    redis:
      url: "${CHANNEL_REDIS_URL:-redis://redis:6379/0}"
      pool_size: 10
      key_prefix: "plexspaces:channel:"
      cluster_mode: false
    sqlite:
      database_path: "${CHANNEL_SQLITE_PATH:-:memory:}"
      wal_mode: true
      cleanup_acked: true
      cleanup_age_seconds: 3600
  
  # KeyValue backend (sqlite, sql/postgres, redis, dynamodb)
  keyvalue_backend:
    backend_type: "${KEYVALUE_BACKEND:-sqlite}"
    sql:
      connection_string: "${PLEXSPACES_KV_POSTGRES_URL:-${PLEXSPACES_KV_SQLITE_PATH:-${DATABASE_URL:-sqlite:///app/data/keyvalue.db}}}"
      pool_size: 10
      auto_migrate: true
    redis:
      url: "${KEYVALUE_REDIS_URL:-redis://redis:6379/0}"
      pool_size: 10
      key_prefix: "plexspaces:kv:"
      cluster_mode: false
  
  # TupleSpace backend (sqlite, sql/postgres, redis, dynamodb)
  tuplespace_backend:
    backend_type: "${TUPLESPACE_BACKEND:-sqlite}"
    sql:
      connection_string: "${TUPLESPACE_POSTGRES_URL:-${TUPLESPACE_SQLITE_PATH:-${DATABASE_URL:-sqlite:///app/data/tuplespace.db}}}"
      pool_size: 10
      auto_migrate: true
    redis:
      url: "${TUPLESPACE_REDIS_URL:-redis://redis:6379/0}"
      pool_size: 10
      key_prefix: "plexspaces:tuplespace:"
      cluster_mode: false

system_applications: []

applications: []

env: {}

shutdown:
  global_timeout_seconds: 30
  grace_period_seconds: 10
  grpc_drain_timeout_seconds: 10















