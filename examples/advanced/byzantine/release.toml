# PlexSpaces Release Configuration for Byzantine Generals Example
#
# This file demonstrates how to deploy the Byzantine Generals consensus example
# as a PlexSpaces Application using the Release framework (Erlang/OTP-inspired).

[release]
name = "byzantine-generals"
version = "0.1.0"
description = "Byzantine Fault Tolerant Consensus Example"

[node]
id = "byzantine-node-1"
listen_address = "0.0.0.0:8000"
cluster_seed_nodes = []

[runtime.grpc]
enabled = true
address = "0.0.0.0:8000"
max_connections = 1000
keepalive_interval_seconds = 30

# gRPC Middleware Configuration (Phase 3.1-3.8 Complete)
# Demonstrates production-ready interceptors: Metrics + Auth + Rate Limiting + Compression + Tracing
[[runtime.grpc.middleware]]
type = "metrics"
enabled = true
priority = 10  # Highest priority - always runs first

[[runtime.grpc.middleware]]
type = "auth"
enabled = true
priority = 30
# JWT Authentication with permissive mode (allows unauthenticated for development)
[runtime.grpc.middleware.config.auth]
method = "jwt"
jwt_key = "byzantine-generals-secret-key"  # HMAC HS256 secret
allow_unauthenticated = true  # Permissive mode for demo

[[runtime.grpc.middleware]]
type = "rate_limit"
enabled = true
priority = 40
[runtime.grpc.middleware.config.rate_limit]
requests_per_second = 1000
burst_size = 100

[[runtime.grpc.middleware]]
type = "compression"
enabled = true
priority = 50
[runtime.grpc.middleware.config.compression]
min_compression_size_bytes = 1024
algorithm = "gzip"

[[runtime.grpc.middleware]]
type = "tracing"
enabled = true
priority = 20
[runtime.grpc.middleware.config.tracing]
service_name = "byzantine-generals"
sampling_rate = 1.0

[runtime.health]
heartbeat_interval_seconds = 2
heartbeat_timeout_seconds = 10
registry_url = "http://localhost:9000"

# System applications (PlexSpaces core infrastructure)
[system_applications]
included = [
    "plexspaces-core",
    "plexspaces-tuplespace",
    "plexspaces-actor",
    "plexspaces-supervisor",
]

# Byzantine Generals application
[[applications]]
name = "byzantine-generals"
version = "0.1.0"
config_path = "examples/byzantine/config.toml"
enabled = true
auto_start = true
shutdown_timeout_seconds = 30
shutdown_strategy = "graceful"
dependencies = []  # No dependencies for this example

# Environment variables
[env]
LOG_LEVEL = "info"
BYZANTINE_GENERAL_COUNT = "4"
BYZANTINE_FAULT_COUNT = "1"

[byzantine]
general_count = 4
fault_count = 1
tuplespace_backend = "memory"
redis_url = ""
postgres_url = ""

# Graceful shutdown configuration
[shutdown]
global_timeout_seconds = 300
grace_period_seconds = 10
grpc_drain_timeout_seconds = 30
